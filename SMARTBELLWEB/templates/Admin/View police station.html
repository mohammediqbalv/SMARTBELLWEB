{% extends "Admin/homeindex.html" %}
{% block body %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0"><i class="fas fa-police-box me-2"></i>Police Stations Management</h4>
                    <a href="/MyApp/addpolicestation/" class="btn btn-light btn-sm">
                        <i class="fas fa-plus-circle me-1"></i> Add New Station
                    </a>
                </div>
                <div class="card-body">
                    <!-- Search Form -->
                    <form id="searchForm" name="form1" method="post" action="/MyApp/Viewpolicestation_post/#ab" class="mb-4">
                        {% csrf_token %}
                        <div class="row g-3 align-items-end">
                            <div class="col-md-8 col-lg-6">
                                <label for="textfield" class="form-label fw-semibold">Search Stations</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fas fa-search"></i></span>
                                    <input type="text" name="textfield" id="textfield" class="form-control" 
                                           placeholder="Search by name, place, phone or email...">
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-3">
                                <button type="submit" name="button" id="button" class="btn btn-primary w-100">
                                    <i class="fas fa-search me-1"></i> Search
                                </button>
                            </div>
                           
                        </div>
                    </form>

                    <!-- DataTable with enhanced features -->
                    <div class="table-responsive">
                        <table class="table table-hover table-striped display" id="policeStationTable" style="width:100%">
                            <thead class="table-dark">
                                <tr>
                                    <th width="5%">#</th>
                                    <th width="15%">Station Name</th>
                                    <th width="12%">Place</th>
                                    <th width="12%">Post</th>
                                    <th width="8%">PIN Code</th>
                                    <th width="12%">Phone No</th>
                                    <th width="15%">Email</th>
                                    <th width="10%">Status</th>
                                    <th width="11%" class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in data %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                          
                                            <span class="fw-semibold">{{ i.policestationname }}</span>
                                        </div>
                                    </td>
                                    <td>{{ i.place }}</td>
                                    <td>{{ i.post }}</td>
                                    <td>
                                        <span class="badge bg-light text-dark">{{ i.pin }}</span>
                                    </td>
                                    <td>
                                        <i class="fas fa-phone text-success me-1"></i>
                                        {{ i.phoneno }}
                                    </td>
                                    <td>
                                        {% if i.email %}
                                            <i class="fas fa-envelope text-primary me-1"></i>
                                            <small>{{ i.email }}</small>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-success rounded-pill">
                                            <i class="fas fa-check-circle me-1"></i> Active
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group" role="group">
                                            <a href="/MyApp/editpolicestation/{{ i.LOGIN.id }}#ab" 
                                               class="btn btn-sm btn-outline-primary" 
                                               title="Edit" data-bs-toggle="tooltip">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="/MyApp/delete_policestation/{{ i.id }}" 
                                               class="btn btn-sm btn-outline-danger" 
                                               title="Delete" data-bs-toggle="tooltip"
                                               onclick="return confirm('Are you sure you want to delete this police station?');">
                                                <i class="fas fa-trash-alt"></i>
                                            </a>
                                            <button type="button" class="btn btn-sm btn-outline-info" 
                                                    title="View Details" data-bs-toggle="tooltip"
                                                    onclick="showStationDetails('{{ i.policestationname }}', '{{ i.place }}', '{{ i.post }}', '{{ i.pin }}', '{{ i.phoneno }}', '{{ i.email }}')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="9" class="text-center py-4">
                                        <div class="text-muted">
                                            <i class="fas fa-inbox fa-3x mb-3"></i>
                                            <h5>No Police Stations Found</h5>
                                            <p>Add your first police station using the "Add New Station" button</p>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Table Summary -->
                <div class="card-footer bg-light">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Showing {{ data|length }} police station(s)
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">
                                <i class="fas fa-database me-1"></i>
                                Total Records: {{ data|length }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Station Details Modal -->
<div class="modal fade" id="stationDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>Station Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4 text-center mb-4">
                        <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 120px; height: 120px;">
                            <i class="fas fa-shield-alt fa-3x text-white"></i>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <table class="table table-borderless">
                            <tr>
                                <th width="30%">Station Name:</th>
                                <td id="detailName" class="fw-semibold"></td>
                            </tr>
                            <tr>
                                <th>Place:</th>
                                <td id="detailPlace"></td>
                            </tr>
                            <tr>
                                <th>Post:</th>
                                <td id="detailPost"></td>
                            </tr>
                            <tr>
                                <th>PIN Code:</th>
                                <td><span class="badge bg-light text-dark" id="detailPin"></span></td>
                            </tr>
                            <tr>
                                <th>Phone:</th>
                                <td><i class="fas fa-phone text-success me-1"></i><span id="detailPhone"></span></td>
                            </tr>
                            <tr>
                                <th>Email:</th>
                                <td><i class="fas fa-envelope text-primary me-1"></i><span id="detailEmail"></span></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="window.print()">
                    <i class="fas fa-print me-1"></i> Print
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

<script>
    $(document).ready(function () {
        // Initialize DataTable with enhanced features
        const table = $('#policeStationTable').DataTable({
            "pageLength": 10,
            "lengthMenu": [5, 10, 25, 50, 100],
            "order": [[1, 'asc']],
            "language": {
                "lengthMenu": "Show _MENU_ entries",
                "zeroRecords": "No matching police stations found",
                "info": "Showing _START_ to _END_ of _TOTAL_ stations",
                "infoEmpty": "No stations available",
                "infoFiltered": "(filtered from _MAX_ total stations)",
                "search": "Quick Search:",
                "paginate": {
                    "first": "First",
                    "last": "Last",
                    "next": "Next",
                    "previous": "Previous"
                }
            },
            "dom": '<"row"<"col-md-6"B><"col-md-6"f>>' +
                   '<"row"<"col-md-12"tr>>' +
                   '<"row"<"col-md-5"i><"col-md-7"p>>',
            "buttons": [
                {
                    extend: 'excelHtml5',
                    text: '<i class="fas fa-file-excel me-1"></i> Excel',
                    className: 'btn btn-success btn-sm'
                },
                {
                    extend: 'pdfHtml5',
                    text: '<i class="fas fa-file-pdf me-1"></i> PDF',
                    className: 'btn btn-danger btn-sm'
                },
                {
                    extend: 'print',
                    text: '<i class="fas fa-print me-1"></i> Print',
                    className: 'btn btn-info btn-sm'
                },
                {
                    extend: 'copy',
                    text: '<i class="fas fa-copy me-1"></i> Copy',
                    className: 'btn btn-secondary btn-sm'
                }
            ],
            "initComplete": function() {
                // Add custom filter for status
                this.api().columns([7]).every(function() {
                    const column = this;
                    const select = $('<select class="form-select form-select-sm ms-2 d-inline-block w-auto"><option value="">All Status</option><option value="Active">Active</option><option value="Inactive">Inactive</option></select>')
                        .appendTo($('.dt-buttons'))
                        .on('change', function() {
                            const val = $(this).val();
                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
                });
            }
        });

        // Initialize Bootstrap tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Custom search from form
        $('#searchForm').on('submit', function(e) {
            e.preventDefault();
            const searchTerm = $('#textfield').val();
            table.search(searchTerm).draw();
        });
    });

    // Function to show station details in modal
    function showStationDetails(name, place, post, pin, phone, email) {
        $('#detailName').text(name);
        $('#detailPlace').text(place);
        $('#detailPost').text(post);
        $('#detailPin').text(pin);
        $('#detailPhone').text(phone);
        $('#detailEmail').text(email || 'Not provided');
        
        const modal = new bootstrap.Modal(document.getElementById('stationDetailsModal'));
        modal.show();
    }

    // Export functions
    function exportToExcel() {
        $('#policeStationTable').DataTable().button('.buttons-excel').trigger();
    }

    function exportToPDF() {
        $('#policeStationTable').DataTable().button('.buttons-pdf').trigger();
    }

    function printTable() {
        $('#policeStationTable').DataTable().button('.buttons-print').trigger();
    }
</script>

<style>
    .dataTables_wrapper .dt-buttons {
        margin-bottom: 1rem;
    }
    .dataTables_wrapper .dataTables_filter {
        float: right;
    }
    .dataTables_wrapper .dataTables_length {
        margin-top: 1rem;
    }
    .dataTables_wrapper .dataTables_paginate {
        margin-top: 1rem;
    }
    table.dataTable thead th {
        border-bottom: 2px solid #dee2e6;
    }
    .btn-group .btn {
        margin: 0 2px;
    }
    .card {
        border: none;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    .table-hover tbody tr:hover {
        background-color: rgba(13, 110, 253, 0.05);
    }
    .badge {
        font-weight: 500;
    }
</style>

{% endblock %}