{% extends "Admin/homeindex.html" %}
{% block body %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Reply</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .card-header {
            border-radius: 15px 15px 0 0 !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .reply-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items-center: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        .reply-icon i {
            font-size: 36px;
            color: white;
        }
        .form-control {
            border-radius: 10px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
        }
        .btn-send {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn-send:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .back-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
        }
        .back-btn:hover {
            background-color: #5a6268;
            color: white;
        }
        .char-counter {
            font-size: 0.85rem;
            color: #6c757d;
            text-align: right;
            margin-top: 5px;
        }
        .complaint-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card">
                <div class="card-header text-white text-center py-4">
                    <h3 class="mb-0"><i class="fas fa-reply me-2"></i>Send Reply</h3>
                    <p class="mb-0 opacity-75">Respond to user complaint</p>
                </div>
                <div class="card-body p-4">
                    <!-- User Complaint Preview -->
                    <div class="complaint-preview">
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">User Complaint</h6>
                                <small class="text-muted">Complaint ID: #{{ id }}</small>
                            </div>
                        </div>
                        <div class="complaint-content">
                            <p class="mb-0" id="complaintTexta">{{ complaint }}</p>
                        </div>
                    </div>
                    
                    <form id="form1" name="form1" method="post" action="/MyApp/Sendreply_post/">
                        {% csrf_token %}
                        <input type="hidden" value="{{ id }}" name="id">
                        
                        <div class="text-center mb-4">
                            <div class="reply-icon">
                                <i class="fas fa-reply-all"></i>
                            </div>
                            <h5 class="text-muted">Craft your response</h5>
                        </div>

                        <!-- Reply Field -->
                        <div class="mb-4">
                            <label for="textfield" class="form-label fw-semibold">
                                <i class="fas fa-comment-dots me-1 text-primary"></i>Your Reply
                            </label>
                            <textarea name="textfield" id="textfield" 
                                     class="form-control" 
                                     rows="5" 
                                     placeholder="Type your reply here... Be professional, clear, and helpful."
                                     maxlength="500"
                                     oninput="updateCharCounter()"
                                     required></textarea>
                            <div class="char-counter" id="charCounter">
                                <span id="charCount">0</span> / 500 characters
                            </div>
                            <div class="form-text">Your reply will be sent to the user</div>
                        </div>

                        <!-- Response Templates (Quick Options) -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-bolt me-1 text-warning"></i>Quick Response Templates
                            </label>
                            <div class="btn-group d-flex flex-wrap gap-2" role="group">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="useTemplate('Thank you for your feedback. We have noted your concern and will look into it.')">
                                    <i class="fas fa-thumbs-up me-1"></i> Acknowledgment
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-success" onclick="useTemplate('Your issue has been resolved. Thank you for bringing it to our attention.')">
                                    <i class="fas fa-check-circle me-1"></i> Resolved
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-info" onclick="useTemplate('We are investigating your concern and will update you within 24 hours.')">
                                    <i class="fas fa-search me-1"></i> Investigating
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-warning" onclick="useTemplate('We need more information to help you. Could you please provide additional details?')">
                                    <i class="fas fa-question-circle me-1"></i> Need Info
                                </button>
                            </div>
                        </div>

                        <!-- Tone Suggestions -->
                        <div class="alert alert-light border" role="alert">
                            <h6 class="alert-heading mb-2">
                                <i class="fas fa-volume-up me-2 text-primary"></i>Tone Suggestions
                            </h6>
                            <ul class="mb-0" style="font-size: 14px;">
                                <li>Be professional and courteous</li>
                                <li>Acknowledge the user's concern</li>
                                <li>Provide clear next steps or solutions</li>
                                <li>Use a positive and helpful tone</li>
                                <li>Keep it concise but complete</li>
                            </ul>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                           
                            <button type="submit" name="button" id="button" class="btn btn-send text-white">
                                <i class="fas fa-paper-plane me-1"></i> Send Reply
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Guidelines Footer -->
                <div class="card-footer bg-light">
                    <div class="row">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-eye me-2"></i>Reply Preview</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Original Complaint:</label>
                            <div class="form-control" style="min-height: 150px;" id="previewComplaint">
                                Loading...
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Your Reply:</label>
                            <div class="form-control" style="min-height: 150px; background-color: #e8f5e9; border-left: 4px solid #51cf66;" id="previewReply">
                                Your reply will appear here
                            </div>
                        </div>
                    </div>
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    This is how your reply will appear to the user. Make sure it addresses all their concerns.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Editing</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="document.getElementById('form1').submit()">
                    <i class="fas fa-paper-plane me-1"></i> Send Now
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function() {
        // Initialize character counter
        updateCharCounter();
        
        // Load complaint details (you would typically fetch this from your backend)
        loadComplaintDetails();
    });
    
    // Update character counter
    function updateCharCounter() {
        const textarea = document.getElementById('textfield');
        const charCount = textarea.value.length;
        const maxLength = 500;
        
        document.getElementById('charCount').textContent = charCount;
        
        const counter = document.getElementById('charCounter');
        if (charCount > maxLength * 0.9) {
            counter.classList.add('text-danger');
            counter.classList.remove('text-warning');
        } else if (charCount > maxLength * 0.75) {
            counter.classList.add('text-warning');
            counter.classList.remove('text-danger');
        } else {
            counter.classList.remove('text-danger', 'text-warning');
        }
        
        // Trim if exceeds max length
        if (charCount > maxLength) {
            textarea.value = textarea.value.substring(0, maxLength);
            updateCharCounter();
        }
    }
    
    // Use template for quick response
    function useTemplate(template) {
        const textarea = document.getElementById('textfield');
        textarea.value = template;
        updateCharCounter();
        
        // Show success feedback
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-1"></i> Applied';
        button.classList.remove('btn-outline-primary', 'btn-outline-success', 'btn-outline-info', 'btn-outline-warning');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add(button.classList.contains('btn-outline-success') ? 'btn-outline-success' : 
                               button.classList.contains('btn-outline-info') ? 'btn-outline-info' : 
                               button.classList.contains('btn-outline-warning') ? 'btn-outline-warning' : 'btn-outline-primary');
        }, 1500);
    }
    
    // Preview reply
    function previewReply() {
        const reply = document.getElementById('textfield').value;
        
        if (!reply.trim()) {
            alert('Please write a reply before previewing.');
            document.getElementById('textfield').focus();
            return;
        }
        
        document.getElementById('previewReply').textContent = reply;
        
        const modal = new bootstrap.Modal(document.getElementById('previewModal'));
        modal.show();
    }
    
    // Load complaint details (simulated - you would fetch from your backend)
    function loadComplaintDetails() {
        // In a real application, you would fetch this data from your server
        // This is a placeholder
        const complaintId = '{{ id }}';
        
        // Simulate loading
        setTimeout(() => {
            document.getElementById('complaintText').textContent = 
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";
            
            document.getElementById('previewComplaint').textContent = 
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";
        }, 500);
    }
    
    // Form validation
    document.getElementById('form1').addEventListener('submit', function(e) {
        const reply = document.getElementById('textfield').value.trim();
        
        if (!reply) {
            e.preventDefault();
            alert('Please write a reply before sending.');
            document.getElementById('textfield').focus();
            return;
        }
        
        if (reply.length < 10) {
            if (!confirm('Your reply is very short. Are you sure you want to send it?')) {
                e.preventDefault();
                return;
            }
        }
        
        // Show loading state
        const submitButton = document.getElementById('button');
        const originalHTML = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Sending...';
        submitButton.disabled = true;
        
        // Allow form submission to proceed
        setTimeout(() => {
            submitButton.innerHTML = originalHTML;
            submitButton.disabled = false;
        }, 3000);
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + Enter to submit
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            document.getElementById('form1').submit();
        }
        
        // Ctrl/Cmd + S to preview
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            previewReply();
        }
        
        // Escape to cancel
        if (e.key === 'Escape') {
            if (confirm('Are you sure you want to cancel? Your reply will be lost.')) {
                history.back();
            }
        }
    });
</script>
</body>
</html>
{% endblock %}